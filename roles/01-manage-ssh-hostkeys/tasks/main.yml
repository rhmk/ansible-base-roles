---

# fetch all public hostkeys and store them in hostkey format
# <hostname> <algorithm> <key>

- name collect-hostkeys
  fetch:
    src=/etc/ssh/ssh_host_*_key.pub
    dest=hostkeys/{{ inventory_hostname }}
    flat: yes

#-name: collect-rsa-hostkey
#    local_action: copy content={{ ansible_ssh_host_key_rsa_public }} dest=/etc/ansible/roles/files/hostkeys/rsa_pub.{{ ansible_hostname }}

# make sure all public hostkeys are added to /etc/ssh/ssh_known_hosts
- name: tell the host about our servers it might want to ssh to
  known_hosts:
    path: /etc/ssh/ssh_known_hosts
    name: foo.com.invalid
    key: "{{ lookup('file', 'pubkeys/foo.com.invalid') }}"
...
